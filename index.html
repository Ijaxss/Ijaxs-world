<script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyOAaqhXSW7La0wMk_4_fRPd1HJiUskbGROHoSqpyPmRUtMnhL_yLZjf27zGrRHIRpoFg/exec";

    async function updateRecord(nama, tindakan) {
        let jumlahInput = document.getElementById(nama);
        let jumlah = parseFloat(jumlahInput.value);

        if (isNaN(jumlah) || jumlah <= 0) {
            alert("Masukkan jumlah yang sah!");
            return;
        }

        let params = new URLSearchParams();
        params.append("nama", nama);
        params.append("tindakan", tindakan);
        params.append("jumlah", jumlah);

        try {
            let response = await fetch(scriptURL, {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: params
            });

            let result = await response.text();
            if (result.trim() === "Success") {
                jumlahInput.value = ""; // Kosongkan input selepas berjaya
                fetchData(); // Refresh jumlah terkini
            } else {
                alert("Ralat: " + result);
            }
        } catch (error) {
            console.error("Error:", error);
            alert("Gagal menghubungi server. Semak URL Web App!");
        }
    }

    async function fetchData() {
        try {
            let response = await fetch(scriptURL);
            let data = await response.json();
            data.slice(1).forEach(row => {
                let nama = row[0];
                let jumlah = row[1];
                let jumlahSpan = document.getElementById(nama + "-jumlah");

                if (jumlahSpan) {
                    jumlahSpan.textContent = jumlah;
                }
            });
        } catch (error) {
            console.error("Error fetching data:", error);
        }
    }

    window.onload = fetchData;
</script>
